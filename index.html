
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Hotdoguería RD - POS</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
     <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Overlay sutil de fondo -->
    <div id="app-background"></div>
<div id="splash-screen" class="screen active centered-content">
  <img src="https://firebasestorage.googleapis.com/v0/b/la-hotdogeria.firebasestorage.app/o/logo.png.png?alt=media&token=fdc65094-44ad-4c69-a3fb-a2b5a81f1097" alt="La Hotdoguería RD Logo" class="auth-logo">
    <p>Cargando sistema...</p>
</div>

  <div id="login-screen" class="screen centered-content">
 <div class="auth-container">
   <img src="https://firebasestorage.googleapis.com/v0/b/la-hotdogeria.firebasestorage.app/o/logo.png.png?alt=media&token=fdc65094-44ad-4c69-a3fb-a2b5a81f1097" alt="Logo" class="auth-logo">
        <h1>La Hotdoguería RD</h1>
            <p class="tagline">"El clásico que nunca falla"</p>
            <div class="form-group">
                <label for="login-user">Nombre de Usuario:</label>
                <input type="text" id="login-user" placeholder="Tu nombre de usuario" autocomplete="username" required>
            </div>
            <div class="form-group">
                <label for="login-password">Contraseña:</label>
                <div class="password-input-wrapper">
                    <input type="password" id="login-password" placeholder="Tu contraseña" autocomplete="current-password" required>
                    <span class="password-toggle" id="password-toggle"><i class="fas fa-eye"></i></span>
                </div>
            </div>
            <button id="login-button" class="button-primary">Acceder</button>
            <a href="#" class="auth-link" id="forgot-password-link">¿Olvidaste tu contraseña?</a>
        </div>
    </div>

    <div id="recover-password-screen" class="screen centered-content">
        <div class="auth-container">
            <h2>Recuperar Contraseña</h2>
            <p>Ingresa tu email registrado para enviarte un enlace de recuperación.</p>
            <!-- El contenido se generará con JS para no duplicar código -->
            <button class="button-secondary" id="back-to-login-link">Volver al Inicio</button>
        </div>
    </div>

    <!-- APLICACIÓN PRINCIPAL -->
    <div id="main-app" class="screen">
       <header class="header-bar">
  <div class="header-left">
    <img src="https://firebasestorage.googleapis.com/v0/b/la-hotdogeria.firebasestorage.app/o/logo.png.png?alt=media&token=fdc65094-44ad-4c69-a3fb-a2b5a81f1097" alt="Logo" class="app-header-logo">
    <span class="app-title">La Hotdoguería RD</span>
</div>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span id="current-user-name">Usuario</span>
                <span id="current-user-id"></span>
            </div>
            <div class="header-right">
                <div id="connection-status" class="online">
                    <i class="fas fa-wifi"></i>
                    <span id="connection-status-text">En Línea</span>
                </div>
                <span id="current-datetime">Fecha y Hora</span>
                <button id="set-team-members-button" class="icon-button hidden" title="Configurar Miembros del Turno">
                    <i class="fas fa-users-cog"></i>
                </button>
                <button id="theme-toggle-button" class="icon-button" title="Cambiar Tema">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="logout-button" class="icon-button" title="Cerrar Sesión">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <nav class="nav-bar">
            <ul class="nav-list">
                <li><a href="#" data-section="ventas"><i class="fas fa-cash-register"></i><span>Ventas</span></a></li>
                <li class="admin-only"><a href="#" id="apply-discount-nav-link" class="new-discount-button" data-action="aplicar-descuento"><i class="fas fa-tag"></i><span>Descuento</span></a></li>
                <li><a href="#" data-section="inventario"><i class="fas fa-warehouse"></i><span>Inventario</span><span id="low-stock-count" class="badge hidden">0</span></a></li>
                <li class="admin-only"><a href="#" data-section="usuarios"><i class="fas fa-users"></i><span>Usuarios</span></a></li>
                <li><a href="#" data-section="cuadrecaja"><i class="fas fa-calculator"></i><span>Caja (Turno)</span></a></li>
                <li><a href="#" data-section="salidaentrada"><i class="fas fa-exchange-alt"></i><span>Salida/Entrada</span></a></li>
                <li><a href="#" data-section="ventas-dia"><i class="fas fa-receipt"></i><span>Ventas del Día</span></a></li>
                <li class="admin-only"><a href="#" data-section="cuentas"><i class="fas fa-file-invoice-dollar"></i><span>Cuentas por Cobrar</span></a></li>
                <li class="admin-only"><a href="#" data-section="admin-reports"><i class="fas fa-chart-line"></i><span>Reportes Admin</span></a></li>
            </ul>
        </nav>

        <div class="content-area">
            <main class="main-content">
                <!-- ================== Sección Ventas ================== -->
                <section id="ventas-section" class="content-section">
                    <p id="sales-section-placeholder" class="placeholder-text hidden">La caja está cerrada. Por favor, abre la caja para registrar ventas.</p>

                    <div class="sales-content-wrapper">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="product-search-input" placeholder="Buscar producto por nombre o escanear código...">
                        </div>
                                                <div class="category-filters">
                            <label for="category-select">Filtrar por Categoría:</label>
                            <select id="category-select">
                                <option value="all">Todas</option>
                            </select>
                        </div>
                        
                        <div id="apply-promo-section" class="hidden">
                             <h4>Aplicar Descuento</h4>
                             <div class="form-group">
                                 <label for="discount-type-select">Tipo:</label>
                                 <select id="discount-type-select">
                                     <option value="none">Ninguno</option>
                                     <option value="percentage">Porcentaje (%)</option>
                                     <option value="fixed">Monto Fijo (RD$)</option>
                                 </select>
                             </div>
                             <div class="form-group" id="discount-value-group">
                                 <label for="discount-value-input">Valor:</label>
                                 <input type="number" id="discount-value-input" placeholder="0.00" min="0" step="0.01">
                             </div>
                             <button id="apply-manual-discount-button" class="new-discount-button-sales"><i class="fas fa-check"></i> Aplicar</button>
                        </div>

                        <div id="products-grid" class="products-grid">
                            <p class="placeholder-text">Cargando productos...</p>
                        </div>
                    </div>
                </section>

                <!-- ================== Sección Inventario ================== -->
                <section id="inventario-section" class="content-section">
                    <h2>Gestión de Inventario</h2>
                    <div class="controls-bar">
                        <button id="add-product-button" class="button-primary admin-only"><i class="fas fa-plus"></i> Añadir Producto</button>
                        <button id="open-inventory-movement-modal-button" class="button-secondary"><i class="fas fa-right-left"></i> Registrar Movimiento</button>
                    </div>

                    <div id="inventory-list-container">
                        <p class="placeholder-text">Cargando inventario...</p>
                    </div>

                    <h4>Historial de Movimientos de Inventario (Turno Actual)</h4>
                    <div id="inventory-movements-history-container">
                        <p class="placeholder-text">Abra la caja para ver los movimientos del turno.</p>
                    </div>
                </section>
                                <!-- ================== Sección Usuarios (Admin) ================== -->
                <section id="usuarios-section" class="content-section">
                    <div class="section-header">
                       <h2>Gestión de Usuarios</h2>
                       <button id="add-user-button" class="button-primary admin-only">
                           <i class="fas fa-plus"></i> Añadir Usuario
                       </button>
                   </div>
                   <p class="section-description">Crea, edita y gestiona los perfiles de los colaboradores y administradores.</p>
                   <div id="user-list-container" class="table-container">
                       <p class="placeholder-text">Cargando lista de usuarios...</p>
                   </div>
                </section>

                <!-- ================== Sección Cuentas por Cobrar (Admin) ================== -->
                <section id="cuentas-section" class="content-section">
                    <h2>Cuentas por Cobrar</h2>
                    <p class="section-description">Visualiza y gestiona todas las deudas pendientes de clientes y empleados.</p>
                    
                    <div class="controls-bar">
                        <div class="form-group" style="flex-grow: 1;">
                            <i class="fas fa-search"></i>
                            <input type="text" id="cuentas-search-input" placeholder="Buscar por nombre o ID...">
                        </div>
                    </div>

                    <div id="cuentas-list-container">
                        <p class="placeholder-text">Cargando cuentas pendientes...</p>
                    </div>
                </section>

                <!-- ================== Sección Ventas del Día (Rediseñada) ================== -->
                <section id="ventas-dia-section" class="content-section">
                    <h2>Historial de Ventas</h2>
                    <div class="sales-history-layout">
                        <!-- Columna de Filtros y Lista de Facturas -->
                        <div class="sales-list-column">
                            <div class="filters-container">
                                <div class="form-group">
                                    <label for="sales-history-search-input"><i class="fas fa-search"></i> Buscar</label>
                                    <input type="text" id="sales-history-search-input" placeholder="Buscar por ID o Cliente...">
                                </div>
                                <div class="form-group admin-only" style="display: none;">
                                    <label for="sales-history-user-filter"><i class="fas fa-user-tie"></i> Vendedor</label>
                                    <select id="sales-history-user-filter">
                                        <option value="all">Todos los Vendedores</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="sales-history-start-date">Desde:</label>
                                    <input type="date" id="sales-history-start-date">
                                </div>
                                <div class="form-group">
                                    <label for="sales-history-end-date">Hasta:</label>
                                    <input type="date" id="sales-history-end-date">
                                </div>
                                <button id="sales-history-search-button" class="button-primary"><i class="fas fa-search"></i> Buscar</button>
                            </div>
                            <div class="invoice-list-container" id="daily-sales-list">
                                <p class="placeholder-text">Use los filtros para buscar facturas.</p>
                            </div>
                            
                            <div class="daily-sales-total-container">
                                <span>Total Filtrado</span>
                                <strong id="daily-sales-total">RD$0.00</strong>
                            </div>
                        </div>
                        
                        <!-- Columna de Vista Previa de la Factura -->
                        <div class="sales-preview-column" id="daily-sales-preview">
                            <p class="placeholder-text">Selecciona una factura de la lista para verla aquí.</p>
                        </div>
                    </div>
                </section>

                <!-- ================== Sección Salida y Entrada de Caja ================== -->
                <section id="salidaentrada-section" class="content-section">
                    <h2>Salidas y Entradas de Efectivo</h2>
                    <p class="section-description">Registra dinero que entra o sale de la caja y que no es una venta (ej. pago a proveedores, compra de insumos).</p>
                    
                    <div class="cash-io-container">
                        <div class="cash-io-box">
                            <h4><i class="fas fa-arrow-down"></i> Registrar Entrada de Dinero</h4>
                            <div class="form-group">
                                <label for="add-petty-cash-description-input">Descripción:</label>
                                <input type="text" id="add-petty-cash-description-input" placeholder="Fondo extra, cambio, etc.">
                            </div>
                            <div class="form-group">
                                 <label for="add-petty-cash-amount-input">Monto (RD$):</label>
                                <input type="number" id="add-petty-cash-amount-input" placeholder="0.00" min="0" step="0.01">
                            </div>
                            <button id="add-petty-cash-button" class="button-primary"><i class="fas fa-plus"></i> Agregar Saldo</button>
                        </div>

                        <div class="cash-io-box">
                            <h4><i class="fas fa-arrow-up"></i> Registrar Salida de Dinero</h4>
                            <div class="form-group">
                                 <label for="output-description-input">Descripción:</label>
                               <input type="text" id="output-description-input" placeholder="Compra de insumos, pago, etc.">
                           </div>
                           <div class="form-group">
                                <label for="output-amount-input">Monto (RD$):</label>
                               <input type="number" id="output-amount-input" placeholder="0.00" min="0" step="0.01">
                           </div>
                            <button id="record-output-button" class="button-danger"><i class="fas fa-minus"></i> Registrar Salida</button>
                        </div>
                    </div>
                    
                    <h4>Historial de Movimientos (Turno Actual)</h4>
                   <div id="cash-movements-history-container">
                         <p class="placeholder-text">Abra la caja para ver los movimientos del turno.</p>
                    </div>
                </section>
                
                <!-- ================== Sección Caja (Turno) ================== -->
                <section id="cuadrecaja-section" class="content-section">
                    <h2>Gestión de Caja y Turno</h2>
                    <p class="section-description">Inicia tu turno, consulta los totales en tiempo real y realiza el cuadre final.</p>

                                       <div class="cash-actions">
                        <div class="cash-open-inputs">
                            <div class="form-group">
                                <label for="initialCashInput">Dinero Inicial en Caja:</label>
                                <input type="number" id="initialCashInput" value="0.00" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="cashChangeInput">Cambio Adicional:</label>
                                <input type="number" id="cashChangeInput" value="0.00" step="0.01">
                            </div>
                        </div>
                        <button class="btn-open-cash" id="openCashBtn"><i class="fas fa-play-circle"></i> Abrir Caja</button>
                        <!-- BOTÓN NUEVO AÑADIDO -->
                        <button class="button-tertiary" id="generateShiftReportBtn" class="hidden"><i class="fas fa-file-invoice"></i> Reporte del Turno</button>
                        <button class="btn-cash-balance" id="cashBalanceBtn"><i class="fas fa-tasks"></i> Cuadre de Caja</button>
                        <button class="btn-close-cash" id="closeCashBtn"><i class="fas fa-stop-circle"></i> Cerrar Caja</button>
                    </div>

                    <!-- Dashboard de totales del turno -->
                    <div class="cash-management-section">
                        <div class="cash-box">
                            <h3><i class="fas fa-cash-register"></i> Totales de Ventas</h3>
                            <div class="cash-entry"><label>Ventas en Efectivo:</label> <span id="cashSalesAmount">RD$0.00</span></div>
                            <div class="cash-entry"><label>Ventas con Tarjeta:</label> <span id="cardPayments">RD$0.00</span></div>
                            <div class="cash-entry"><label>Ventas por Transferencia:</label> <span id="transferPayments">RD$0.00</span></div>
                            <div class="cash-entry"><label>Ventas a Crédito:</label> <span id="creditPayments">RD$0.00</span></div>
                            <div class="cash-total"><span>Total Ventas:</span> <span id="totalPayments">RD$0.00</span></div>
                        </div>
                                                <div class="cash-box">
                            <h3><i class="fas fa-wallet"></i> Movimientos de Efectivo</h3>
                            <div class="cash-entry"><label>Efectivo Inicial (Total):</label> <span id="cashEntriesTotal">RD$0.00</span></div>
                            <div class="cash-entry"><label>(+) Entradas Adicionales:</label> <span id="totalEntries">RD$0.00</span></div>
                            <div class="cash-entry"><label>(-) Salidas (Pagos):</label> <span id="supplierPayments">RD$0.00</span></div>
                            <div class="cash-total"><span>Efectivo Esperado:</span> <span id="currentEstimatedCashInHandDisplay">RD$0.00</span></div>
                        </div>
                        
                        <div class="cash-box wide-box">
                            <h3><i class="fas fa-chart-pie"></i> Ventas por Categoría</h3>
                            <div id="departmentSalesChartContainer" class="chart-container-area">
                                <p class="placeholder-text">Abra la caja para ver gráfico.</p>
                            </div>
                        </div>

                        <div class="cash-box wide-box">
                             <h3><i class="fas fa-credit-card"></i> Métodos de Pago (Cantidad)</h3>
                             <div id="paymentMethodsChartContainer" class="chart-container-area">
                                <p class="placeholder-text">Abra la caja para ver gráfico.</p>
                            </div>
                         </div>
                    </div>
                </section>
                                <!-- ================== Sección Reportes de Admin ================== -->
                <section id="admin-reports-section" class="content-section">
                    <h2>Reportes de Administrador</h2>
                    <p class="section-description">Análisis detallado de operaciones: ventas, ganancias, comisiones y cuentas por cobrar.</p>

                    <div class="controls-bar">
                        <div class="form-group">
                            <label for="admin-report-start-date">Desde:</label>
                            <input type="date" id="admin-report-start-date">
                        </div>
                        <div class="form-group">
                            <label for="admin-report-end-date">Hasta:</label>
                            <input type="date" id="admin-report-end-date">
                        </div>
                        <div class="form-group">
                            <label for="admin-report-employee-select">Empleado (Opcional):</label>
                            <select id="admin-report-employee-select">
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        <button id="generate-admin-report-button" class="button-primary"><i class="fas fa-file-alt"></i> Generar Reporte</button>
                        <button id="generate-commission-details-button" class="button-secondary"><i class="fas fa-search-dollar"></i> Ver Comisiones Detalladas</button>
                    </div>

                    <!-- Contenedor para el reporte detallado de comisiones -->
                    <div id="commission-details-container" class="hidden"></div>
                    
                    <!-- Contenedor para el reporte general del admin -->
                    <div id="admin-report-details-container">
                        <p class="placeholder-text">Selecciona un rango de fechas y opciones para generar el reporte.</p>
                        
                        <div class="report-grid">
                            <!-- Sección de KPIs y Gráficos -->
                            <div class="report-main-panel">
                                <div class="report-section">
                                    <div class="report-section-header active" id="summary-section-header">
                                        <h4>Resumen Financiero del Período</h4>
                                        <i class="fas fa-chevron-up"></i>
                                    </div>
                                    <div class="report-section-content" id="summary-section-content" style="max-height: fit-content;">
                                        <div class="report-kpi-cards"></div>
                                        <div class="chart-container-area tall-chart">
                                            <h5>Tendencia de Ventas y Ganancias</h5>
                                            <canvas id="salesTrendChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="report-section">
                                    <div class="report-section-header" id="commissions-section-header">
                                        <h4>Comisiones por Empleado</h4>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="report-section-content" id="commissions-section-content">
                                        <div class="chart-container-area tall-chart">
                                            <canvas id="commissionStackedBarChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Columna Lateral con Tablas -->
                            <div class="report-side-panel">
                                <div class="report-section">
                                    <div class="report-section-header" id="cash-balances-section-header">
                                        <h4>Cuadres de Caja</h4>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="report-section-content" id="cash-balances-section-content">
                                        <p class="placeholder-text">Cargando...</p>
                                    </div>
                                </div>
                                <div class="report-section">
                                    <div class="report-section-header" id="accounts-receivable-section-header">
                                        <h4>Cuentas por Cobrar</h4>
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                    <div class="report-section-content" id="accounts-receivable-section-content">
                                        <div class="chart-container-area small-chart">
                                            <canvas id="accountsReceivableChart"></canvas>
                                        </div>
                                        <div id="accounts-receivable-table-container">
                                            <p class="placeholder-text">Cargando...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                         <!-- Tabla de ventas detalladas al final -->
                        <div class="report-section full-width-section">
                            <div class="report-section-header" id="sales-details-section-header">
                                <h4>Detalle de Ventas Individuales</h4>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="report-section-content" id="sales-details-section-content">
                                <p class="placeholder-text">Cargando...</p>
                            </div>
                        </div>
                    </div>
                </section>

            </main>

            <!-- ================== Barra Lateral del Carrito ================== -->
            <aside class="cart-sidebar">
                <h3><i class="fas fa-shopping-cart"></i> Carrito de Compras</h3>
                <ul id="cart-items-list">
                    <li class="cart-placeholder">El carrito está vacío</li>
                </ul>

                <p id="applied-discount-display" class="hidden">Promoción Aplicada: <span></span> <button id="clear-discount-button" class="icon-button small" title="Eliminar Descuento"><i class="fas fa-times-circle"></i></button></p>

                <div class="cart-summary">
                     <p id="cart-subtotal-summary">Subtotal: <span id="cart-subtotal-amount">RD$0.00</span></p>
                     <p id="cart-discount-summary" class="hidden">Descuento: <span id="cart-discount-amount">- RD$0.00</span></p>
                    <p id="cart-total-summary">Total: <span id="cart-total-amount">RD$0.00</span></p>
                </div>
                
                <div id="payment-method-section" class="hidden">
                    <h4>Método de Pago</h4>
                    <select id="payment-method-select">
                        <option value="efectivo">Efectivo</option>
                        <option value="tarjeta">Tarjeta</option>
                        <option value="transferencia">Transferencia</option>
                        <option value="credito">Crédito</option>
                        <option value="otro">Otro Método</option>
                    </select>
                    <div id="cash-payment-details" class="hidden">
                        <div class="form-group">
                            <label for="amount-received-input">Monto Recibido (RD$):</label>
                            <input type="number" id="amount-received-input" placeholder="0.00" min="0" step="0.01">
                        </div>
                        <p>Cambio: <span id="change-amount-display">RD$0.00</span></p>
                    </div>
                </div>

                <button id="process-sale-button" class="button-primary" disabled>Procesar Venta</button>
                <p id="sale-verse" class="hidden">Jehová Jiréh - ¡Gracias por su compra!</p>
            </aside>
        </div>
        
        <div class="watermark-credit">
            <p>Develop by Juan Calcaño | Programmer & Designer</p>
        </div>
    </div>

    <!-- ========================================================== -->
    <!-- ======================== MODALES ========================= -->
    <!-- ========================================================== -->

    <!-- Modal de Guía de Usuario -->
    <div id="user-guide-overlay" class="modal hidden">
        <div class="modal-content" style="max-width: 600px; text-align: left;">
            <button class="close-modal-button" id="close-guide-button">×</button>
            <h2><i class="fa-solid fa-book-open"></i> Guía Rápida del Sistema</h2>
            <div class="guide-points">
                <h4><i class="fa-solid fa-power-off"></i> Gestión de Turno</h4>
                <ul>
                    <li><strong>Abrir Caja:</strong> Ve a "Caja (Turno)", ingresa tu efectivo inicial y haz clic en "Abrir Caja". Ninguna venta es posible sin un turno abierto.</li>
                    <li><strong>Cerrar Caja:</strong> Al final del día, ve a "Caja (Turno)" y haz clic en "Cerrar Caja". Confirma el conteo de efectivo para finalizar.</li>
                </ul>
                <h4><i class="fa-solid fa-store"></i> Proceso de Venta</h4>
                <ul>
                    <li><strong>Añadir Productos:</strong> Haz clic en los productos en la sección "Ventas" para añadirlos al carrito a la derecha.</li>
                    <li><strong>Carrito:</strong> Puedes cambiar la cantidad o precio (con permiso) o eliminar productos del carrito.</li>
                    <li><strong>Procesar:</strong> Elige el método de pago (Efectivo, Tarjeta, Crédito) y haz clic en "Procesar Venta".</li>
                </ul>
                <h4><i class="fa-solid fa-box-archive"></i> Inventario y Movimientos</h4>
                <ul>
                    <li><strong>Ver Stock:</strong> La sección "Inventario" muestra todos tus productos y su stock actual.</li>
                    <li><strong>Movimientos:</strong> Usa el botón "Registrar Movimiento" para añadir stock (Entrada) o registrar mermas/daños.</li>
                    <li><strong>Salidas y Entradas de Efectivo:</strong> Usa la sección "Salida/Entrada" para registrar dinero que no es una venta (ej. pago a proveedores).</li>
                </ul>
                <h4><i class="fa-solid fa-user-shield"></i> Funciones de Administrador</h4>
                <ul>
                    <li><strong>Usuarios:</strong> En la sección "Usuarios" puedes crear o editar los perfiles.</li>
                    <li><strong>Reportes:</strong> La sección "Reportes Admin" te da un análisis completo de ventas, ganancias, comisiones y deudas por rango de fechas.</li>
                    <li><strong>Control Total:</strong> Solo los administradores pueden aplicar descuentos, anular facturas y gestionar usuarios.</li>
                </ul>
            </div>
            <div class="modal-buttons" style="justify-content: center; margin-top: 20px;">
                 <button id="ok-guide-button" class="button-primary">Entendido</button>
            </div>
        </div>
    </div>
        <!-- Modal de Código de Administrador -->
    <div id="admin-code-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2>Autorización de Administrador</h2>
            <p id="admin-code-modal-message">Ingrese el código para continuar.</p>
            <div class="form-group">
                <label for="modal-admin-code-input">Código:</label>
                <input type="password" id="modal-admin-code-input" placeholder="Código secreto">
            </div>
            <button id="modal-verify-admin-code-button" class="button-primary">Verificar</button>
        </div>
    </div>
        <!-- Modal para Añadir/Editar Producto -->
    <div id="product-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2 id="product-modal-title">Añadir Producto</h2>
            <div id="product-modal-content">
                <div class="form-group">
                    <label for="product-name-input">Nombre:</label>
                    <input type="text" id="product-name-input" placeholder="Nombre del producto">
                </div>
                <div class="form-group">
                    <label for="product-code-input">Código:</label>
                    <input type="text" id="product-code-input" placeholder="Ej: HD001">
                </div>
                <div class="form-group">
                    <label for="product-category-input">Categoría:</label>
                    <input type="text" id="product-category-input" placeholder="Ej: Bebidas, Hot Dogs">
                </div>
                <div class="form-group-row">
                    <div class="form-group">
                        <label for="product-box-price-input">Precio Caja/Paquete</label>
                        <input type="number" id="product-box-price-input" placeholder="Ej: 1200.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="product-box-units-input">Unidades por Caja</label>
                        <input type="number" id="product-box-units-input" placeholder="Ej: 24" step="1">
                    </div>
                </div>
                <div class="form-group">
                    <label for="product-cost-input">Costo por Unidad (RD$):</label>
                    <input type="number" id="product-cost-input" placeholder="Calculado o manual" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="product-price-input">Precio Venta (RD$):</label>
                    <input type="number" id="product-price-input" placeholder="0.00" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="product-stock-input">Stock Inicial:</label>
                    <input type="number" id="product-stock-input" placeholder="0" min="0" step="1">
                </div>
                <button id="save-product-button" class="button-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Añadir/Editar Usuario -->
    <div id="user-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2 id="user-modal-title">Añadir Usuario</h2>
            <div class="form-group">
                <label for="user-name-input">Nombre Completo:</label>
                <input type="text" id="user-name-input" placeholder="Nombre para mostrar">
            </div>
            <div class="form-group">
                <label for="user-username-input">Nombre de Usuario (Login):</label>
                <input type="text" id="user-username-input" placeholder="Sin espacios ni caracteres especiales">
            </div>
             <div class="form-group">
                <label for="user-role-select">Rol:</label>
                <select id="user-role-select">
                    <option value="colaborator">Colaborador</option>
                    <option value="admin">Administrador</option>
                </select>
             </div>
            <div class="form-group">
                <label for="user-email-input">Email (Login):</label>
                <input type="email" id="user-email-input" placeholder="Correo electrónico del usuario">
            </div>
            <div class="form-group">
                <label for="user-password-input">Contraseña:</label>
                <input type="password" id="user-password-input" placeholder="Contraseña inicial (al añadir)">
            </div>
            <div class="form-group">
                <label for="user-id-input">UID (Firebase Auth):</label>
                <input type="text" id="user-id-input" placeholder="Se genera y pega desde Firebase Auth" disabled>
            </div>
            
            <fieldset class="commission-fieldset">
                <legend>Configuración de Comisiones</legend>
                <div class="form-group inline-checkbox"> 
                    <input type="checkbox" id="user-general-commission-enabled-checkbox">
                    <label for="user-general-commission-enabled-checkbox">Habilitar Comisión General por Venta</label>
                </div>
                <div id="user-general-commission-amount-group" class="form-group hidden"> 
                    <label for="user-general-commission-amount-input">Monto Comisión General por Venta (RD$):</label>
                    <input type="number" id="user-general-commission-amount-input" placeholder="0.00" min="0" step="0.01">
                </div>
                <div class="form-group inline-checkbox">
                    <input type="checkbox" id="user-hotdog-commission-enabled-checkbox">
                    <label for="user-hotdog-commission-enabled-checkbox">Habilitar Comisión por Hotdog</label>
                </div>
                <div id="user-hotdog-commission-amount-group" class="form-group hidden"> 
                    <label for="user-hotdog-commission-per-item-input">Comisión por Hotdog Vendido (RD$):</label>
                    <input type="number" id="user-hotdog-commission-per-item-input" placeholder="0.00" min="0" step="0.01">
                </div>
            </fieldset>

            <div class="form-group inline-checkbox"> 
                <input type="checkbox" id="user-is-team-account-checkbox">
                <label for="user-is-team-account-checkbox">Es una cuenta de equipo (para turnos compartidos)</label>
            </div>
            <button id="save-user-button" class="button-primary">Guardar</button>
        </div>
    </div>

    <!-- Modal para Editar Item del Carrito -->
     <div id="edit-cart-item-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2>Editar Item del Carrito</h2>
             <p>Producto: <strong id="edit-cart-item-name"></strong></p>
            <div class="form-group">
                <label for="edit-cart-item-quantity">Cantidad:</label>
                <input type="number" id="edit-cart-item-quantity" placeholder="1" min="1" step="1">
                 <small id="edit-cart-item-stock-info">Stock disponible: ---</small>
            </div>
            <div class="form-group">
                <label for="edit-cart-item-price">Precio (RD$):</label>
                <input type="number" id="edit-cart-item-price" placeholder="0.00" min="0" step="0.01">
            </div>
            <div class="modal-buttons">
                <button id="save-edited-cart-item-button" class="button-primary">Guardar Cambios</button>
            </div>
        </div>
     </div>

    <!-- Modal de Confirmación de Acción Genérico -->
    <div id="confirm-action-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2 id="confirm-modal-title">Confirmar Acción</h2>
            <p id="confirm-modal-message">¿Está seguro?</p>
            <div class="modal-buttons">
                <button id="confirm-yes-button" class="button-danger">Sí, Confirmar</button>
                <button id="confirm-no-button" class="button-secondary">No, Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Previsualización de Factura -->
     <div id="invoice-preview-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button" id="close-invoice-modal-button">×</button>
            <h2>Previsualización de Factura</h2>
            <div id="invoice-content" class="invoice-preview-area">
                <!-- El HTML de la factura se inyectará aquí -->
            </div>
            <div class="modal-buttons">
                 <button id="print-invoice-button" class="button-secondary"><i class="fas fa-print"></i> Imprimir</button>
                 <button id="modal-download-pdf-button" class="button-primary"><i class="fas fa-file-pdf"></i> Descargar PDF</button>
                 <button id="delete-invoice-button" class="button-danger admin-only"><i class="fas fa-ban"></i> Anular</button>
                 <button id="modify-invoice-button" class="button-tertiary"><i class="fas fa-edit"></i> Corregir</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Nombre de Cliente -->
     <div id="customer-name-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Nombre del Cliente <small>(Opcional)</small></h2>
            <p>Ingresa el nombre del cliente para la factura.</p>
            <div class="form-group">
                <label for="modal-customer-name-input">Nombre:</label>
                <input type="text" id="modal-customer-name-input" placeholder="Cliente Contado">
            </div>
            <div class="modal-buttons">
                <button id="confirm-customer-name-button" class="button-primary">Confirmar Venta</button>
                <button id="skip-customer-name-button" class="button-secondary">Omitir y Procesar</button>
            </div>
        </div>
    </div>
        <!-- Modal para Registrar Movimientos de Inventario -->
    <div id="inventory-movement-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2>Registrar Movimiento de Inventario</h2>
            <div class="form-group">
                <label for="modal-inv-move-product-select">Producto:</label>
                <select id="modal-inv-move-product-select">
                    <option value="">Selecciona un producto</option>
                </select>
            </div>
            <div class="form-group">
                <label for="modal-inv-move-type-select">Tipo de Movimiento:</label>
                <select id="modal-inv-move-type-select">
                    <option value="in">Entrada de Stock (Compra)</option>
                    <option value="out_waste">Salida (Merma/Daño)</option>
                    <option value="out_use">Salida (Uso Interno)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="modal-inv-move-quantity-input">Cantidad:</label>
                <input type="number" id="modal-inv-move-quantity-input" placeholder="0" min="1" step="1">
            </div>
            <div class="form-group">
                <label for="modal-inv-move-description-input">Descripción:</label>
                <input type="text" id="modal-inv-move-description-input" placeholder="Detalles del movimiento">
            </div>
            <button id="modal-record-inventory-movement-button" class="button-primary">Registrar Movimiento</button>
        </div>
    </div>
        <!-- Modal para configurar miembros del turno -->
    <div id="set-team-members-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2>Configurar Miembros del Turno</h2>
            <p>Selecciona los miembros del equipo que están trabajando en este turno bajo tu cuenta.</p>
            <div class="form-group">
                <label for="shift-name-input">Nombre del Turno (Opcional):</label>
                <input type="text" id="shift-name-input" placeholder="Ej: Turno Noche, Fin de Semana">
            </div>
            <div class="form-group">
                <label>Miembros Activos:</label>
                <ul id="team-members-selection-list" class="team-members-list">
                    <p class="placeholder-text">Cargando usuarios...</p>
                </ul>
            </div>
            <div class="modal-buttons">
                <button id="print-shift-report-button" class="button-tertiary"><i class="fas fa-print"></i> Imprimir Reporte de Turno</button>
                <button id="save-team-members-button" class="button-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Cuadre de Caja -->
    <div id="cash-balance-display-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2 id="cash-balance-modal-title">Cuadre de Caja</h2>
            <div id="cash-balance-modal-content">
                <!-- Contenido se inyecta con JS -->
            </div>
            <div class="modal-buttons">
                <button id="cash-balance-confirm-real-cash" class="button-primary">Confirmar Cuadre</button>
            </div>
        </div>
    </div>

    <!-- Modal para Gestión de Cuentas a Crédito -->
    <div id="credit-account-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2 id="credit-account-modal-title">Registrar Venta a Crédito</h2>
            <div class="form-group">
                <label for="credit-customer-search">Buscar Cliente Existente:</label>
                <input type="text" id="credit-customer-search" placeholder="Busca por nombre o ID...">
                <ul id="credit-customer-results" class="search-results-list"></ul>
            </div>
            <p class="or-divider">-- O --</p>
            <div class="form-group">
                <label for="credit-customer-name">Nuevo Cliente (Nombre):</label>
                <input type="text" id="credit-customer-name" placeholder="Nombre completo del nuevo cliente">
            </div>
            <div class="form-group">
                <label for="credit-customer-contact">Contacto (Teléfono/Email):</label>
                <input type="text" id="credit-customer-contact" placeholder="Opcional">
            </div>
            <input type="hidden" id="credit-customer-id-display">
            <div class="credit-summary">
                <h4>Detalles de la Venta a Crédito</h4>
                <p>Monto Total del Carrito: <strong id="credit-cart-total-amount">RD$0.00</strong></p>
                <p>Items a Crédito:</p>
                <ul id="credit-cart-items-list"></ul>
            </div>
            <div class="modal-buttons">
                <button id="confirm-credit-sale-button" class="button-primary">Registrar Crédito</button>
            </div>
        </div>
    </div>

    <!-- Modal para Registrar Abono a Cuenta por Cobrar -->
    <div id="record-payment-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2>Registrar Abono a Cuenta</h2>
            <div class="payment-details-grid">
                <div><label>Cliente:</label><span id="rp-customer-name"></span></div>
                <div><label>Total Deudado:</label><span id="rp-total-due">RD$0.00</span></div>
                <div><label>Saldo Pendiente:</label><span id="rp-balance">RD$0.00</span></div>
            </div>
            <div class="form-group">
                <label for="rp-amount-input">Monto a Abonar (RD$):</label>
                <input type="number" id="rp-amount-input" step="0.01" min="0.01" placeholder="0.00">
            </div>
            <div class="form-group">
                <label for="rp-description-input">Descripción del Pago:</label>
                <input type="text" id="rp-description-input" placeholder="Pago parcial, abono, etc.">
            </div>
            <div class="modal-buttons">
                <button id="rp-confirm-payment-button" class="button-primary">Confirmar Pago</button>
            </div>
        </div>
    </div>
    
          <!-- Modal para gestionar caja de otro usuario (Admin) -->
    <div id="admin-manage-cashbox-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <!-- VERIFICA ESTE ID -->
            <h2 id="admin-manage-cashbox-title">Gestionar Caja de [Usuario]</h2>
            <!-- VERIFICA ESTE ID -->
            <div id="admin-manage-cashbox-status" class="status-line"></div>
            <div class="cash-actions admin-actions" style="flex-direction: column; gap: 1rem; margin-top: 1.5rem;">
                <!-- VERIFICA ESTOS IDs -->
                <button id="admin-manage-open-btn" class="button-primary"><i class="fas fa-play"></i> Abrir Caja para este Usuario</button>
                <button id="admin-manage-add-btn" class="button-secondary"><i class="fas fa-plus-circle"></i> Añadir Fondos</button>
                <button id="admin-manage-remove-btn" class="button-secondary"><i class="fas fa-minus-circle"></i> Retirar Fondos</button>
                <button id="admin-manage-close-btn" class="button-danger"><i class="fas fa-stop"></i> Forzar Cierre y Cuadre de Caja</button>
            </div>
        </div>
    </div>
        <!-- Modal para Abrir Caja para otro Usuario (Admin) -->
    <div id="admin-open-cashbox-form-modal" class="modal hidden">
        <div class="modal-content">
            <button class="close-modal-button">×</button>
            <h2 id="admin-open-cashbox-form-title">Abrir Caja para [Usuario]</h2>
            <p>Ingresa los valores iniciales para el turno de este usuario.</p>
            <div class="form-group">
                <label for="admin-initial-cash-input">Fondo de Caja Inicial (RD$):</label>
                <input type="number" id="admin-initial-cash-input" value="0.00" step="0.01">
            </div>
            <div class="form-group">
                <label for="admin-cash-change-input">Cambio Adicional (RD$):</label>
                <input type="number" id="admin-cash-change-input" value="0.00" step="0.01">
            </div>
            <div class="modal-buttons">
                <button id="admin-confirm-open-cashbox-btn" class="button-primary">Confirmar y Abrir Caja</button>
            </div>
        </div>
    </div>
    <!-- Contenedor para Notificaciones Toast -->
    <div id="toast-container"></div>

    <!-- Firebase SDKs (v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <!-- Librerías para generar PDF y Gráficos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Tu script principal de la aplicación -->
    <script src="app.js" defer></script>

</body>
</html>